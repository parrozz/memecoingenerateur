<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Token Builder ‚Äì local & simple</title>
  <style>
    :root{
      --bg:#0b0f17; --panel:#121826; --edge:#1b2336; --text:#e6ebff; --muted:#9fb0d7; --acc:#6aa6ff; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(160deg,#0b0f17,#0d1220);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans",sans-serif;}
    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
    .hero{display:flex;gap:18px;align-items:center;margin-bottom:18px}
    .logo{width:38px;height:38px;border-radius:12px;background:conic-gradient(from 210deg,#6aa6ff,#7cf2f7,#7af79a,#6aa6ff);}
    h1{font-size:22px;margin:0}
    .card{background:var(--panel);border:1px solid var(--edge);border-radius:18px;padding:18px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns: 580px 1fr}}
    label{font-size:12px;color:var(--muted);display:block;margin:8px 0 6px}
    input,select,textarea{width:100%;padding:12px 13px;border-radius:12px;border:1px solid #26304a;background:#0f1524;color:var(--text);outline:none}
    textarea{min-height:72px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 14px;border-radius:12px;border:1px solid #2a3452;background:#16203a;color:#fff;cursor:pointer;font-weight:600}
    .btn.primary{background:linear-gradient(160deg,#3b82f6,#22d3ee);border-color:#2b5fcc}
    .btn.success{background:linear-gradient(160deg,#22c55e,#06b6d4);border-color:#19994c}
    .btn.warning{background:linear-gradient(160deg,#f59e0b,#ef4444);border-color:#c47b08}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{padding:6px 10px;border:1px solid #2a3452;background:#0f1524;border-radius:999px;font-size:12px;color:var(--muted)}
    .out{white-space:pre-wrap;background:#0a1222;border:1px dashed #273153;border-radius:14px;padding:14px;color:#d8e4ff;min-height:80px}
    .muted{color:var(--muted)}
    a{color:#9cc7ff;text-decoration:none}
    .kpi{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
    .kpi>div{background:#0f1628;border:1px solid #273153;border-radius:12px;padding:10px;text-align:center}
    .hint{font-size:12px;color:var(--muted)}
    .danger{color:var(--err)}
    .dropzone{border:1px dashed #2a3a62;background:#0d1529;border-radius:12px;padding:14px;height:120px;display:flex;align-items:center;justify-content:center;text-align:center;color:var(--muted);cursor:pointer}
    .dropzone.has-file{border-color:#22c55e;color:#dfffe8;background:#0e1b2d}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="logo"></div>
      <div>
        <h1>SeulCoin‚Äëstyle Token Builder (local, 100% contr√¥le)</h1>
        <div class="muted">G√©n√®re un script PowerShell en 1‚Äì2 lignes pour cr√©er ton token SPL, minter, envoyer au wallet, poser les metadata et te donner le lien Raydium.</div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row">
          <div>
            <label>R√©seau</label>
            <select id="network">
              <option value="mainnet">mainnet</option>
              <option value="devnet">devnet (test)</option>
            </select>
          </div>
          <div>
            <label>Adresse Phantom (r√©ception)</label>
            <input id="owner" placeholder="Ton wallet Phantom" value="" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Nom du token</label>
            <input id="name" placeholder="Ex: SHIBA ANTONIN" />
          </div>
          <div>
            <label>Ticker</label>
            <input id="symbol" placeholder="Ex: ANTON" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>D√©cimales</label>
            <input id="decimals" type="number" value="9" min="0" max="9" />
          </div>
          <div>
            <label>Supply totale (lisible)</label>
            <input id="supply" placeholder="ex: 1000000000" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Envoyer au wallet (lisible)</label>
            <input id="send" placeholder="ex: 200000000" />
          </div>
          <div>
            <label>% pr√©vu pour la pool (indicatif)</label>
            <input id="poolpct" type="number" min="0" max="100" value="20" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Verrouiller l‚Äôautorit√© de mint ?</label>
            <select id="lockmint">
              <option value="true">Oui (recommand√©)</option>
              <option value="false">Non (je garde le mint)</option>
            </select>
          </div>
          <div>
            <label>Autorit√© de gel (freeze)</label>
            <select id="freeze">
              <option value="disable">D√©sactiver (recommand√©)</option>
              <option value="keep">Conserver</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Activer les metadata (nom/ticker/logo visibles)</label>
            <select id="metaset">
              <option value="true">Oui</option>
              <option value="false">Non</option>
            </select>
          </div>
          <div>
            <label>URI Metadata (IPFS/Arweave HTTPS)</label>
            <input id="uri" placeholder="https://‚Ä¶/metadata.json" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Logo du token (glisser-d√©poser ou cliquer)</label>
            <div id="drop" class="dropzone">D√©pose ton image ici (PNG/JPG) ou clique pour choisir</div>
            <input id="file" type="file" accept="image/*" style="display:none" />
            <div class="hint">Astuce¬†: quand tu exportes <code>metadata.json</code>, on t√©l√©charge aussi l'image (ex¬†: <b>logo.png</b>). Uploade les 2 sur IPFS, puis colle l'URL du JSON ici.</div>
          </div>
          <div>
            <label>Liens (facultatifs)</label>
            <input id="website" placeholder="https://ton-site.com" />
            <input id="twitter" placeholder="https://twitter.com/ton_handle" style="margin-top:8px" />
            <input id="telegram" placeholder="https://t.me/ton_channel" style="margin-top:8px" />
            <div class="hint">Ces liens seront ajout√©s dans <code>metadata.extensions</code> (Metaplex).</div>
          </div>
        </div>

        <div>
          <label>Description (facultatif ‚Äì sera mise dans le JSON export√©)</label>
          <textarea id="desc" placeholder="Pitch du coin, liens, etc."></textarea>
          <div class="hint">Pour le logo¬†: uploade l‚Äôimage sur IPFS (Pinata/nft.storage), puis mets l‚ÄôURL dans le JSON. Le programme <code>spl-token metadata</code> utilise l‚ÄôURI.</div>
        </div>

        <div class="chips">
          <button class="btn" id="btnMeta">üì¶ Exporter <b>metadata.json</b> + image</button>
          <button class="btn primary" id="btnGen">‚ö° G√©n√©rer le script</button>
        </div>
      </div>

      <div class="card">
        <div class="kpi" style="margin-bottom:12px">
          <div><div class="muted">Owner recevra</div><div id="kOwner" style="font-weight:700;font-size:18px">‚Äì</div></div>
          <div><div class="muted">Restera c√¥t√© CLI</div><div id="kCli" style="font-weight:700;font-size:18px">‚Äì</div></div>
          <div><div class="muted">% pr√©vu pour pool</div><div id="kPool" style="font-weight:700;font-size:18px">‚Äì</div></div>
        </div>
        <div class="muted" style="margin-bottom:8px">1‚Äëligne PowerShell (copie/colle ‚Üí Entr√©e) :</div>
        <div class="out" id="oneLiner">(g√©n√©r√© ici)</div>
        <div class="chips" style="margin-top:8px">
          <button class="btn success" id="copy1">Copier la 1‚Äëligne</button>
          <button class="btn" id="dlPs1">‚¨áÔ∏è T√©l√©charger make_token.ps1</button>
        </div>
        <hr style="border:0;border-top:1px solid #273153;margin:18px 0" />
        <div class="muted">Lien Raydium (cr√©ation de pool)¬†:</div>
        <p><a href="https://raydium.io/create-pool" target="_blank">https://raydium.io/create-pool</a></p>
        <p class="hint">Apr√®s ex√©cution du script, r√©cup√®re l‚Äôadresse du <b>Mint</b> affich√©e, puis cr√©e la pool <b>SOL / TON_TOKEN</b>.</p>
        <div class="hint">S√©curit√©¬†: ex√©cute d‚Äôabord sur <b>devnet</b> pour tester √† faible co√ªt. Garde toujours un peu de SOL pour les frais.</div>
      </div>
    </div>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    // Image state
    let imgBlob = null; let imgName = 'logo.png'; let imgPreviewUrl = '';

    // Compute quick KPIs
    function refreshKPIs(){
      const supply = ($('#supply').value||'').trim();
      const send = ($('#send').value||'0').trim();
      const pct = parseFloat($('#poolpct').value||'0');

      const left = safeSub(supply, send);
      $('#kOwner').textContent = send? send : '0';
      $('#kCli').textContent = left;
      $('#kPool').textContent = pct + '% pr√©vu';
    }

    function safeSub(a,b){
      if(!a) return '0';
      try{ const x = BigInt(a), y = BigInt(b||'0'); return (x-y>=0n? (x-y) : 0n).toString(); }catch(e){ return '‚Äì'; }
    }

    ['supply','send','poolpct'].forEach(id=>{
      $('#'+id).addEventListener('input', refreshKPIs);
    });

    function buildScript(values){
      const block = `param(
  [string]$Network = "${values.network}",
  [string]$Owner = "${values.owner}",
  [string]$Name = "${values.name}",
  [string]$Symbol = "${values.symbol}",
  [int]$Decimals = ${values.decimals},
  [string]$TotalSupply = "${values.supply}",
  [string]$SendToOwner = "${values.send}",
  [bool]$LockMint = ${values.lockmint},
  [string]$Freeze = "${values.freeze}",
  [bool]$SetMetadata = ${values.metaset},
  [string]$MetadataUri = "${values.uri}"
)

Write-Host "==> R√©seau : $Network" -ForegroundColor Cyan
$rpc = if ($Network -eq 'devnet') { 'https://api.devnet.solana.com' } else { 'https://api.mainnet-beta.solana.com' }
solana config set --url $rpc | Out-Null

# 1) Cr√©er le mint
$createOut = spl-token create-token --decimals $Decimals
$mint = ($createOut | Select-String -Pattern 'Address:\\s+(\\S+)').Matches[0].Groups[1].Value
Write-Host ("MINT : $mint") -ForegroundColor Green

# 2) Cr√©er ATA du wallet CLI
$ataOut = spl-token create-account $mint

# 3) Mint supply (valeur lisible)
spl-token mint $mint $TotalSupply | Out-Host

# 4) Envoi vers ton Phantom
if ([bigint]::Parse($SendToOwner) -gt 0) {
  spl-token transfer $mint $SendToOwner $Owner --allow-unfunded-recipient --fund-recipient | Out-Host
}

# 5) Autorit√©s
if ($LockMint) { spl-token authorize $mint mint --disable | Out-Host }
if ($Freeze -eq 'disable') { spl-token authorize $mint freeze --disable | Out-Host }

# 6) Metadata (facultatif)
if ($SetMetadata -and $MetadataUri) {
  spl-token metadata update $mint --uri $MetadataUri --name "$Name" --symbol "$Symbol" | Out-Host
}

# 7) Affichages
spl-token display $mint | Out-Host
Write-Host ("Lien Raydium (Create Pool): https://raydium.io/create-pool")
Write-Host ("
=> Garde le mint: $mint")
`;
      return block;
    }

    function valuesFromUI(){
      const v = {
        network: $('#network').value,
        owner: ($('#owner').value||'').trim(),
        name: ($('#name').value||'').trim(),
        symbol: ($('#symbol').value||'').trim(),
        decimals: ($('#decimals').value||'9').trim(),
        supply: ($('#supply').value||'').trim(),
        send: ($('#send').value||'0').trim(),
        lockmint: $('#lockmint').value === 'true',
        freeze: $('#freeze').value,
        metaset: $('#metaset').value === 'true',
        uri: ($('#uri').value||'').trim(),
        desc: ($('#desc').value||'').trim(),
        website: ($('#website').value||'').trim(),
        twitter: ($('#twitter').value||'').trim(),
        telegram: ($('#telegram').value||'').trim()
      };
      return v;
    }

    function makeOneLiner(ps){
      // Here-string with double-quotes delimiter
      const esc = ps.replace(/`/g,'``'); // escape backticks for safety
      const one = `$s=@"
${esc}
"@; $p="$HOME\\make_token.ps1"; Set-Content -Encoding UTF8 -Path $p -Value $s; powershell -ExecutionPolicy Bypass -File $p`;
      return one;
    }

    function copy(txt){ navigator.clipboard.writeText(txt).then(()=>{ alert('Copi√© !'); }); }
    function downloadFile(name, content, mime){
      const blob = content instanceof Blob ? content : new Blob([content], {type: mime || 'text/plain;charset=utf-8'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download=name; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),250);
    }

    document.getElementById('btnGen').addEventListener('click',()=>{
      const v=valuesFromUI();
      const missing=[];
      if(!v.owner) missing.push('wallet Phantom');
      if(!v.name) missing.push('nom');
      if(!v.symbol) missing.push('ticker');
      if(!v.supply) missing.push('supply totale');
      if(v.metaset && !v.uri) missing.push('URI metadata');
      if(missing.length){ alert('Compl√®te: '+missing.join(', ')); return; }
      const ps = buildScript(v);
      const oneliner = makeOneLiner(ps);
      document.getElementById('oneLiner').textContent = oneliner;
    });

    document.getElementById('copy1').addEventListener('click',()=> copy(document.getElementById('oneLiner').textContent));
    document.getElementById('dlPs1').addEventListener('click',()=>{
      const ps = buildScript(valuesFromUI());
      downloadFile('make_token.ps1', ps);
    });

    // Metadata JSON export (for IPFS)
    document.getElementById('btnMeta').addEventListener('click',()=>{
      const v = valuesFromUI();
      const json = {
        name: v.name || "Your Token",
        symbol: v.symbol || "TOK",
        description: v.desc || "",
        image: imgBlob ? (imgName || 'logo.png') : "https://PLACE_YOUR_IMAGE_URL",
        extensions: {
          website: v.website || "",
          twitter: v.twitter || "",
          telegram: v.telegram || ""
        }
      };
      downloadFile('metadata.json', JSON.stringify(json,null,2));
      if(imgBlob){ downloadFile(imgName || 'logo.png', imgBlob, imgBlob.type); }
      alert('metadata.json export√©' + (imgBlob ? ' + image.' : '.') + ' Uploade-les sur IPFS/Arweave, puis colle l\'URL du JSON dans "URI Metadata" avant de g√©n√©rer le script.');
    });

    refreshKPIs();

    // === Drag & Drop image handling ===
    const drop = document.getElementById('drop'); const fileInput = document.getElementById('file');
    function setPreview(file){
      imgBlob = file; imgName = (file && file.name) ? file.name : 'logo.png';
      if(imgPreviewUrl) URL.revokeObjectURL(imgPreviewUrl);
      imgPreviewUrl = URL.createObjectURL(file);
      drop.classList.add('has-file');
      drop.textContent = 'Image charg√©e: ' + imgName + ' (clique pour changer)';
      drop.style.backgroundImage = `url('${imgPreviewUrl}')`;
      drop.style.backgroundSize = 'cover';
      drop.style.backgroundPosition = 'center';
      drop.style.color = '#e6fbe6';
    }
    function pickFile(){ fileInput.click(); }
    if(drop){
      drop.addEventListener('click', pickFile);
      drop.addEventListener('dragover', (e)=>{ e.preventDefault(); drop.style.borderColor = '#6aa6ff'; });
      drop.addEventListener('dragleave', ()=>{ drop.style.borderColor = '#2a3a62'; });
      drop.addEventListener('drop', (e)=>{ e.preventDefault(); drop.style.borderColor = '#22c55e'; const f = e.dataTransfer.files[0]; if(f) setPreview(f); });
    }
    if(fileInput){ fileInput.addEventListener('change', (e)=>{ const f=e.target.files[0]; if(f) setPreview(f); }); }
  </script>
</body>
</html>
